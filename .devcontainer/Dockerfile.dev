# Note:
# This does not require using the rails application as the base image.
# The decision to use the rails application as the base image is based on the assumption that the rails application will be the main focus of the project.
# It is also reasonable to use a standalone image if development requirements diverge significantly.
FROM dynamic-pricing-base AS devcontainer

# Add development dependencies as needed

# Install bash, Docker CLI, GitHub CLI, OpenSSH (git is in base image; ssh needed for git authentication) docker compose
RUN apk update && \
    apk add --no-cache bash openssh-client curl docker-cli docker-compose github-cli

ARG DOCKER_GID=1
RUN addgroup -g $DOCKER_GID docker || addgroup -g 1001 docker || addgroup docker

ARG DEVELOPER_UID=501
# # note: uid gets updated by devcontainer.json, this is for any file creations that need to be owned by the developer user.
# # UID may be updated at container start by devcontainer (updateRemoteUserUID)
RUN addgroup developer \
    && adduser -D -u $DEVELOPER_UID -G developer developer \
    && adduser developer docker

# Ensure developer user has write permissions to /usr/local/bundle and /home/developer to avoid Bundler Permission Error
RUN chown -R developer:developer /usr/local/bundle /home/developer/ && \
    chmod -R u+w /usr/local/bundle /home/developer

USER developer:developer

CMD ["tail", "-f", "/dev/null"]
